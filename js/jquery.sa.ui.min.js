/**
 * @Author Angus <angusyoung@mrxcool.com>
 * @Description Sa.UI.js for jQuery
 * @Since 16/7/24
 */
!function(t,e,i){"function"==typeof define&&define.amd?define(["$"],i):"undefined"!=typeof module?module.exports=i(require("$")):t[e]=i(t.$)}(this,"saui",function(t){function e(e){this.id=Math.random().toString().substr(2),this.$el=t(e),this.options=this.getOption(),this.resetDate();var i=this.$parent=t('<div class="date-panel card">  <div class="pull-left">     <a href="#" title="上一年" role-action="prevYear"><i class="sa-icon sa-icon-fw sa-icon-angle-double-left"></i></a>     <a href="#" title="上一月" role-action="prevMonth"><i class="sa-icon sa-icon-fw sa-icon-angle-left"></i></a>  </div>  <div class="pull-right">     <a href="#" title="下一月" role-action="nextMonth"><i class="sa-icon sa-icon-fw sa-icon-angle-right"></i></a>     <a href="#" title="下一年" role-action="nextYear"><i class="sa-icon sa-icon-fw sa-icon-angle-double-right"></i></a>  </div></div>');if(this.$container=t('<div class="calendar card-body"></div>'),this.$container.appendTo(i),!this.options.autoClose){var n='<form class="form card-foot">'+(this.options.allowEdit?this.options.isRange?'<div class="pull-left">'+(this.options.showTime?'  <input type="datetime-local"'+(this.options.showSecond?' step="1"':"")+(this.options.min?' min="'+this.options.min+'"':"")+(this.options.max?' max="'+this.options.max+'"':"")+' value="'+this.startDate+"T"+this.selectStartTime+'">-  <input type="datetime-local"'+(this.options.showSecond?' step="1"':"")+(this.options.min?' min="'+this.options.min+'"':"")+(this.options.max?' max="'+this.options.max+'"':"")+' value="'+this.endDate+"T"+this.selectEndTime+'">':'  <input type="date"'+(this.options.min?' min="'+this.options.min+'"':"")+(this.options.max?' max="'+this.options.max+'"':"")+' value="'+this.startDate+'">-  <input type="date"'+(this.options.min?' min="'+this.options.min+'"':"")+(this.options.max?' max="'+this.options.max+'"':"")+' value="'+this.endDate+'">')+'  <span class="bg-error">日期格式填写错误</span></div>':this.options.showTime?'<div class="pull-left">  <input type="time"'+(this.options.showSecond?' step="1"':"")+' value="'+this.selectStartTime+'"></div>':"":"")+'  <div class="pull-right">'+(this.options.todayBtn?'<button type="button" role-action="today">今天</button>':"")+'     <button type="button" class="btn btn-primary" role-action="update">确定</button>  </div></form>';i.append(n)}this.init()}if("undefined"==typeof t)throw"SaUI need jQuery";t(function(){function i(){var e=t('.nav[role="menu"]').eq(0),n=e.data("width"),o=document.documentElement.clientWidth;o<n?e.addClass("nav-mini-menu"):e.removeClass("nav-mini-menu"),t(window).off("resize.menu").on("resize.menu",i)}console.info("\t\t┏━━━┓    ┏┓ ┏┓┏━━┓\n\t\t┃┏━┓┃    ┃┃ ┃┃┗┫┣┛\n\t\t┃┗━━┓┏━━┓┃┃ ┃┃ ┃┃ \n\t\t┗━━┓┃┃┏┓┃┃┃ ┃┃ ┃┃ \n\t\t┃┗━┛┃┃┏┓┃┃┗━┛┃┏┫┣┓\n\t\t┗━━━┛┗┛┗┛┗━━━┛┗━━┛"),t("body").off("ready").on("tap",".dropdown",function(e,i){i?(t(".dropdown[open]").removeClass("dropdown-open").removeAttr("open"),t(this).attr("open",!0).addClass("dropdown-open")):t(this).removeClass("dropdown-open")}).on("touchstart",".dropdown:not(.dropdown-open)",function(){t(this).data("touchTime",(new Date).getTime())}).on("touchend",".dropdown:not(.dropdown-open)",function(){if((new Date).getTime()-t(this).data("touchTime")<300)return t(this).trigger("tap",[!0]),!1}).on("click",".dropdown:not(.dropdown-open)",function(){return t(this).trigger("tap",[!0]),!1}).on("click touchend",".dropdown.dropdown-open",function(){t(this).trigger("tap")}).on("click touchend",".dropdown.dropdown-open .dropdown-head,.dropdown.dropdown-open .dropdown-disabled,.dropdown.dropdown-open .dropdown-divider",function(){return!1}).on("click touchend",function(e){t(".dropdown[open]").removeClass("dropdown-open").removeAttr("open");var i=t(e.target).closest('[role="calendar"]'),n=t('[role="calendar"][open]').not(i),o=n.data("op");o&&o.dismiss()}).on("click",'[role="dialog"]',function(){var e=t(this),i=e.data("type")||"",n=e.data("title")||"",o=e.data("content")||"",a=e.data("event")||"",s=(e.data("size")||",").split(",");switch(i.toLowerCase()){case"alert":t("<div>"+o+"</div>").dialog({type:"alert",onClose:a?window[a]:null,closeType:"dismiss",width:s[0]||300,height:s[1]||100});break;case"confirm":t("<div>"+o+"</div>").dialog({type:"confirm",onClose:a?window[a]:null,closeType:"dismiss",width:s[0],height:s[1]||100});break;default:var l=e.data("custom");t(l).dialog({close:!0,animate:!0,maskClose:!0,onClose:a?window[a]:null,title:n,width:s[0],height:s[1]})}}).on("mouseenter",'[role="tooltip"]',function(){var e=t(this);e.attr("data-active",!0);var i=e.next(".tooltip");switch(e.data("placement")){case"top":i.css({top:e.offset().top-i.outerHeight(!0),left:e.offset().left+e.outerWidth()/2-i.outerWidth()/2});break;case"bottom":i.css({top:e.offset().top+e.outerHeight(),left:e.offset().left+e.outerWidth()/2-i.outerWidth()/2});break;case"left":i.css({left:e.offset().left-i.outerWidth(!0),top:e.offset().top+e.outerHeight()/2-i.outerHeight()/2});break;case"right":i.css({left:e.offset().left+e.outerWidth(),top:e.offset().top+e.outerHeight()/2-i.outerHeight()/2})}}).on("mouseleave",'[role="tooltip"]',function(){t(this).removeAttr("data-active")}).on("touchend",'.nav-menu.nav-mini-menu [role="menu-toggle"]',function(){var e=t(this).closest('.nav-menu[role="menu"]');return e.length&&e.addClass("open-menu").selfScroll(),!1}).on("touchstart",function(e){var i=t(e.target).closest('.nav-menu.open-menu[role="menu"]');i.length||t('.nav-menu.open-menu[role="menu"]').removeClass("open-menu")}).on("click",'.nav-menu.open-menu[role="menu"] a',function(){t('.nav-menu.open-menu[role="menu"]').removeClass("open-menu")}).on("click",'[role="calendar"]:not([open])',function(){new e(this)}),i()}),t.fn.selfScroll=function(){var t,e,i=this;return i.off("touchstart touchend touchmove").on("touchstart touchend",function(i){i.touches.length&&(t=i.touches[0].clientX,e=i.touches[0].clientY)}).on("touchmove",function(t){var i=t.touches[0];i.clientY-e>0?0===this.scrollTop&&t.preventDefault():this.scrollTop+this.offsetHeight===this.scrollHeight&&t.preventDefault()}),i},t.fn.dialog=function(e){var i=this;if(!i.length)throw new Error("Dialog is dismissed");var n=i.data("dialog");if("string"==typeof e){if(n&&n.length){var o={show:function(){var e,i=this;i.data("config").modal&&(e=t(".dialog-mask"),e.length||(e=t('<div class="dialog-mask"></div>').appendTo("body"))),i.css({position:"fixed",left:document.documentElement.clientWidth/2-this.outerWidth()/2,top:Math.max(0,document.documentElement.clientHeight/2-this.outerHeight()/2)}).show(),a.call(i,e)},hide:function(){var e=this;e.hasClass("dialog-animate")?(e.addClass("dialog-close"),setTimeout(function(){e.removeClass("dialog-close").hide()},600)):e.hide(),e.data("config").modal&&t(".dialog-mask").remove()},dismiss:function(){var t=this;t.hasClass("dialog-animate")?(t.addClass("dialog-close"),setTimeout(function(){t.removeClass("dialog-close").remove()},600)):t.remove()}},a=function(t){var e=this,n=e.data("config");e.off("click close.dialog").on("close.dialog",function(t,e){i.dialog(n.closeType),n.onClose&&"function"==typeof n.onClose&&n.onClose(e)}).on("click",".close",function(){e.trigger("close.dialog",["close"])}).on("click",'a.btn[role="done"]',function(){e.trigger("close.dialog",["done"])}).on("click",'a.btn[role="cancel"]',function(){e.trigger("close.dialog",["cancel"])}),n.maskClose&&t.on("click",function(){e.trigger("close.dialog",["mask"])}),n.autoClose&&setTimeout(function(){e.trigger("close.dialog",["auto"])},n.autoClose)};"function"==typeof o[e]&&o[e].call(n)}}else if("object"==typeof e){e=t.extend({modal:!0,close:!1,animate:!1,maskClose:!1,moveable:!1,autoShow:!0,autoClose:0,closeType:"hide",type:"",title:"",doneText:"确定",cancelText:"取消",width:300,height:100},e);var s=n&&n.length;if(!s){var l,r="",h=t('<div class="dialog-content"></div>');if((e.title||e.close)&&(r='<div class="dialog-head">'+(e.close?'<a aria-label="Close" class="close"><i aria-hidden="true">&times;</i></a>':"")+(e.title?"<h3>"+e.title+"</h3>":"")+"</div>"),h.append(i),e.type)switch(l=t('<div class="dialog-foot"></div>'),e.type){case"alert":l.append('<a role="cancel" class="btn btn-primary">'+e.doneText+"</a>");break;case"confirm":l.append('<a role="done" class="btn btn-primary">'+e.doneText+'</a><a role="cancel" class="btn btn-default">'+e.cancelText+"</a>")}var d=t("<div></div>").addClass("dialog").addClass(e.title?"":"dialog-untitled").addClass(e.animate?"dialog-animate":"").css({display:"none",width:e.width}).data("config",e).append(r).append(h.css({height:Math.min(e.height,.9*document.documentElement.clientHeight)})).append(l).appendTo("body");i.data("dialog",d)}e.autoShow&&i.dialog("show")}return i},e.prototype={start:!0,startDate:"2000-01-01",endDate:"2000-01-01",selectStartTime:"08:00:00",selectEndTime:"08:00:00",cenMonth:0,preMonth:0,__check_version:function(){var t=navigator.userAgent.toLowerCase();return t.indexOf("firefox")>-1?"Firefox":t.indexOf("chrome")>-1?"Chrome":t.indexOf("safari")>-1?"Safari":"Other"},__date_string:function(t,e){var i=new Date(t);switch(e){case"D":return i.toLocaleString("nu",{hour12:!1,year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"-");case"T":return i.toLocaleString("nu",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}},__format_string:function(t,e){return t.replace(/^\d{4}-[01]\d-[0123]\d(T[012][0123]:[0-5]\d:[0-5]\d)?$/,function(t,i){var n,o;return o=new Date(t),n=o.getFullYear()+"-"+("0"+(o.getMonth()+1)).slice(-2)+"-"+("0"+o.getDate()).slice(-2)+"T",n+=i?("0"+o.getHours()).slice(-2)+":"+("0"+o.getMinutes()).slice(-2)+":"+("0"+o.getSeconds()).slice(-2):e||"00:00:00"})},__prefix:function(t){if(!t)return"";if(t.indexOf(" ")>0&&(t=t.split(" ").join("T"),t.length<16&&(t+=":00"),"Safari"===this.__check_version())){var e=Math.round((new Date).getTimezoneOffset()/60);t+=e>0?"-"+("0"+e).slice(-2)+":00":"+"+("0"+Math.abs(e)).slice(-2)+":00"}return t},init:function(){this.refresh(),this.$el.data("op",this).attr("open",!0).blur(),this.options.allowEdit||(this.options.rangeEl&&this.options.rangeEl.length?t(this.options.rangeEl[0]).is("input")&&(t(this.options.rangeEl[0]).prop("readonly",!0),t(this.options.rangeEl[1]).prop("readonly",!0)):this.$el.prop("readonly",!0)),this.$parent.appendTo(document.body).css({left:this.$el.offset().left,top:this.$el.offset().top+this.$el.outerHeight()}).fadeOut(0).fadeIn(),this.bindEvent()},resetDate:function(){var t=this.options.date;t instanceof Array?(this.startDate=this.__date_string(t[0],"D"),this.endDate=this.__date_string(t[1],"D")):this.startDate=this.__date_string(t,"D"),this.options.showTime&&(this.options.isRange?(this.selectStartTime=this.__date_string(t[0],"T"),this.selectEndTime=this.__date_string(t[1],"T")):this.selectStartTime=this.selectEndTime=this.__date_string(t,"T"),this.options.showSecond||(this.selectStartTime=this.selectStartTime.split(":").slice(0,2).join(":"),this.selectEndTime=this.selectEndTime.split(":").slice(0,2).join(":"))),this.options.isRange?this.cenMonth=new Date(this.endDate).setDate(1):this.cenMonth=new Date(this.startDate).setDate(1)},getOption:function(){var e={weekStart:0,allowEdit:!1,autoClose:!1,todayBtn:!1,date:(new Date).setHours(8,0,0,0)};this.$el.data("range")&&(e.isRange=!0),(this.$el.is('[type="datetime-local"]')||this.$el.data("show-time")||2===this.$el.find('input[type="datetime-local"]').length)&&(e.showTime=!0),(e.showTime&&this.$el.prop("step")&&this.$el.prop("step")<60||2===this.$el.find('input[type="datetime-local"][step]').length)&&(e.showSecond=!0);var i=this.$el.prop("min")?this.$el.prop("min"):this.$el.data("min");i&&(e.min=this.__format_string(i));var n=this.$el.prop("max")?this.$el.prop("max"):this.$el.data("max");if(n&&(e.max=this.__format_string(n,"23:59:59")),e.allowEdit=!!this.$el.data("editable"),e.isRange||e.allowEdit||!this.$el.data("auto-close")||(e.autoClose=!0),e.isRange){var o=this.$el.find("input");o.length?e.rangeEl=t.map(o,function(i){return t(i).attr("min",e.min).attr("max",e.max),i}):e.rangeEl=t.map(this.$el.find('[role="range"]'),function(t){return t});var a=new Date(this.__prefix(e.rangeEl[0].value||e.rangeEl[0].innerText)).getTime()||(new Date).getTime(),s=new Date(this.__prefix(e.rangeEl[1].value||e.rangeEl[1].innerText)).getTime()||(new Date).getTime();e.date=[a,s]}else e.date=new Date(this.__prefix(this.$el.val()||this.$el.text())).getTime()||(new Date).getTime();return this.$el.data("week-start")&&(e.weekStart=this.$el.data("week-start"),e.weekStart>7&&(e.weekStart=0)),e.weekStart=e.weekStart%7,e.todayBtn=!!this.$el.data("today"),e},bindEvent:function(){var e=this;this.$el.off("change").on("change",function(t){var i=t.target;e.options.isRange?i===e.options.rangeEl[0]?e.options.date[0]=new Date(e.__prefix(i.value)).getTime():i===e.options.rangeEl[1]&&(e.options.date[1]=new Date(e.__prefix(i.value)).getTime()):e.options.date=new Date(e.__prefix(i.value)).getTime(),e.resetDate(),e.refresh()}),this.$parent.on("click",function(){return!1}).on("change",'input[type*="date"]',function(){t(this).is(":first-of-type")?(e.startDate=e.__date_string(this.value,"D"),e.selectStartTime=e.__date_string(this.value,"T")):t(this).is(":last-of-type")&&(e.endDate=e.__date_string(this.value,"D"),e.selectEndTime=e.__date_string(this.value,"T")),e.refresh()}).on("change",'[type="time"]',function(){e.selectStartTime=this.value}).on("click","[role-action]",function(){var i=t(this).attr("role-action");"function"==typeof e[i]&&e[i]()}).on("click","ul>li",function(){var i=t(this).data("date");if(i){var n=e.__date_string(i,"D");if(e.start||!e.options.isRange?(e.startDate=e.endDate=n,e.start=!1):(e.endDate=n,e.start=!0),new Date(e.endDate)<new Date(e.startDate)){var o=e.startDate;e.startDate=e.endDate,e.endDate=o}e.options.autoClose?e.update():e.refresh()}})},dismiss:function(){this.$el.removeAttr("open").removeData("op"),this.$parent.fadeOut(function(){t(this).remove()})},update:function(){var e=this.startDate,i=this.endDate;this.options.showTime&&(e+="T"+this.selectStartTime,i+="T"+this.selectEndTime),this.options.isRange?t(this.options.rangeEl[0]).is("input")?(this.options.rangeEl[0].value=e,this.options.rangeEl[1].value=i):(this.options.rangeEl[0].innerHTML=e.replace("T"," "),this.options.rangeEl[1].innerHTML=i.replace("T"," ")):this.$el.is("input")?this.$el.is('[type*="date"]')?this.$el.val(e):this.$el.val(e.replace("T"," ")):this.$el.html(e.replace("T"," ")),this.$el[0].dispatchEvent(new CustomEvent("change",{detail:{start:e,end:i}})),this.dismiss()},prevYear:function(){var t=new Date(this.cenMonth);this.cenMonth=t.setFullYear(t.getFullYear()-1),this.refresh()},prevMonth:function(){var t=new Date(this.cenMonth);this.cenMonth=t.setMonth(t.getMonth()-1),this.refresh()},nextYear:function(){var t=new Date(this.cenMonth);this.cenMonth=t.setFullYear(t.getFullYear()+1),this.refresh()},nextMonth:function(){var t=new Date(this.cenMonth);this.cenMonth=t.setMonth(t.getMonth()+1),this.refresh()},today:function(){this.cenMonth=(new Date).setDate(1),this.refresh()},refresh:function(){var t="",e=this.options.isRange?[this.startDate,this.endDate]:[this.startDate,this.startDate];if(this.options.isRange&&(this.preMonth=new Date(new Date(this.cenMonth).setDate(0)).setDate(1),t+="\t\t\t\t\t\t\t<dl>\t\t\t\t\t\t\t\t<dt>"+new Date(this.preMonth).toLocaleString("nu",{year:"numeric",month:"long"})+"</dt>\t\t\t\t\t\t\t\t<dd>"+this.write(this.preMonth,e)+"</dd>\t\t\t\t\t\t\t</dl>"),t+="\t\t\t\t\t\t<dl>\t\t\t\t\t\t\t<dt>"+new Date(this.cenMonth).toLocaleString("nu",{year:"numeric",month:"long"})+"</dt>\t\t\t\t\t\t\t<dd>"+this.write(this.cenMonth,e)+"</dd>\t\t\t\t\t\t</dl>",this.$container.html(t),!this.options.autoClose&&this.options.allowEdit)if(this.options.isRange){var i=this.$parent.find("form input");this.options.showTime?(i.eq(0).val(this.startDate+"T"+this.selectStartTime),i.eq(1).val(this.endDate+"T"+this.selectEndTime)):(i.eq(0).val(this.startDate),i.eq(1).val(this.endDate))}else this.$parent.find("form input").val(this.selectStartTime)},write:function(e,i){i[0]=new Date(i[0]).setHours(0,0,0,0),i[1]=new Date(i[1]).setHours(0,0,0,0);var n=new Date(this.options.min).getTime()||0,o=new Date(this.options.max).getTime()||636304608e5,a=new Date(e),s=a.getFullYear(),l=a.getMonth(),r=[12438144e5,12439008e5,12439872e5,12440736e5,124416e7,12442464e5,12443328e5],h=[2,3,4,5,6,7,1];h=[].concat(h.slice(-this.options.weekStart),h.slice(0,h.length-(this.options.weekStart||7)));var d,c=h[(a.getDay()||7)-1]-1,p=new Date(s,l+1,0).getDate(),u=[];for(d=0;d<p;d++)u[c+d]=d+1;var m=[];t.each(h,function(t,e){m[e-1]=new Date(r[t]).toLocaleString("nu",{weekday:"short"})});var f=7*m[0].replace(/\w{2}/g,"@").length+2,g='<ol style="width:'+f+'em;"><li>'+m.join("</li><li>")+"</li></ol>";for(g+='<ul style="width:'+f+'em;">',d=0;d<u.length;d++){var v=u[d];if(v){var w=new Date(s,l,v),D=[],T="",y=' data-date="'+w.getTime()+'"';(new Date).setHours(0,0,0,0)===w.getTime()&&D.push("today"),w.getTime()>=i[0]&&w.getTime()<=i[1]&&(D.push("selected"),w.getTime()===i[1]?D.push("last-of"):w.getTime()===i[0]&&D.push("first-of")),(o&&new Date(o).setHours(0,0,0,0)<w.getTime()||n&&new Date(n).setHours(0,0,0,0)>w.getTime())&&(D.push("disabled"),y=""),D=D.length?' class="'+D.join(" ")+'"':"",T=w.toLocaleString("nu",{year:"numeric",month:"long",day:"numeric"}),g+='<li title="'+T+'"'+y+D+">"+v+"</li>"}else g+="<li></li>"}return g+="</ul>"}}});